; ========================================
; Generated by ttlx 1.0.0
; Source: test-config.yml
; Route: test-connection
; Generated at: 2026-01-03 04:23:47
; ========================================

; === Variables ===
timeout = 30

; === Step 1: bastion ===
:CONNECT_BASTION
connect 'localhost:2222 /ssh /auth=password /user=testuser /passwd=testpass123'
if result <> 2 then
    goto ERROR_CONNECT_BASTION
endif
wait '$ '
if result = 0 then
    goto TIMEOUT_BASTION
endif

; Command: hostname
sendln 'hostname'
wait '$ '
if result = 0 then
    goto TIMEOUT_BASTION
endif

; === Step 2: target ===
sendln 'ssh testuser@target -p 2222'
wait 'password:'
if result = 0 then
    goto TIMEOUT_TARGET
endif

; Password authentication
sendln 'testpass123'

; Command: hostname
sendln 'hostname'
wait '$ '
if result = 0 then
    goto TIMEOUT_TARGET
endif

; Command: ls -la
sendln 'ls -la'
wait '$ '
if result = 0 then
    goto TIMEOUT_TARGET
endif

; === Success (Keep connection alive) ===
:SUCCESS
end

:ERROR_CONNECT_BASTION
messagebox 'Failed to connect to bastion' 'Error'
goto CLEANUP

:TIMEOUT_BASTION
messagebox 'Connection timeout: bastion' 'Error'
goto CLEANUP

:TIMEOUT_TARGET
messagebox 'Connection timeout: target' 'Error'
goto CLEANUP

:CLEANUP
closett
end
